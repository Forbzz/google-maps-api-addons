/**
 * @license Copyright 2014 Martin Matysiak.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
!function(a,b){if("object"==typeof module&&"object"==typeof module.exports)module.exports=b();else if("function"==typeof define&&"object"==typeof define.amd)define(["goog!maps,3,other_params:[sensor=false&libraries=visualization]"],b);else{if("object"!=typeof google||"object"!=typeof google.maps)throw new Error("PanoMarker requires google maps library");a.PanoMarker=b()}}("undefined"!=typeof window?window:this,function(){var a=function(a){a=a||{},this.anchor_=a.anchor||new google.maps.Point(16,16),this.className_=a.className||null,this.clickable_=a.clickable||!0,this.icon_=a.icon||null,this.id_=a.id||null,this.marker_=null,this.pano_=null,this.pollId_=-1,this.position_=a.position||{heading:0,pitch:0},this.povListener_=null,this.size_=a.size||new google.maps.Size(32,32),this.title_=a.title||"",this.visible_=a.visible||!0,this.zIndex_=a.zIndex||1,this.setPano(a.pano||null)};return a.prototype=new google.maps.OverlayView,a.getFov=function(a){return 2>=a?126.5-36.75*a:195.93/Math.pow(1.92,a)},a.povToPixel=function(b,c,d){var e=d.offsetWidth,f=d.offsetHeight,g={left:e/2,top:f/2},h=Math.PI/180,i=a.getFov(c.zoom||1)*h,j=c.heading*h,k=c.pitch*h,l=b.heading*h,m=b.pitch*h,n=e/2/Math.tan(i/2),o=Math.cos(m),p=Math.sin(m),q=Math.cos(l),r=Math.sin(l),s=n*o*r,t=n*o*q,u=n*p,v=Math.cos(k),w=Math.sin(k),x=Math.cos(j),y=Math.sin(j),z=n*v*y,A=n*v*x,B=n*w,C=z*s+A*t+B*u,D=z*z+A*A+B*B;if(Math.abs(C)<1e-6)return null;var E=D/C;if(0>E)return null;var F=E*s,G=E*t,H=E*u,I=-w*y,J=-w*x,K=v,L=x,M=-y,N=0,O=Math.sqrt(L*L+M*M+N*N);L/=O,M/=O,N/=O;var P=F*L+G*M+H*N,Q=F*I+G*J+H*K;return g.left+=P,g.top-=Q,g},a.prototype.onAdd=function(){var a=document.createElement("div");a.style.position="absolute",a.style.cursor="pointer",a.style.width=this.size_.width+"px",a.style.height=this.size_.height+"px",a.style.display=this.visible_?"block":"none",a.style.zIndex=this.zIndex_,this.id_&&(a.id=this.id_),this.className_&&(a.className=this.className_),this.title_&&(a.title=this.title_),this.icon_&&(a.style.backgroundImage="url("+this.icon_+")"),this.id_||this.className_||this.icon_||(a.style.backgroundImage="url(https://www.google.com/intl/en_us/mapfiles/ms/micons/red-dot.png)"),this.marker_=a,this.getPanes().overlayMouseTarget.appendChild(a),window.addEventListener("resize",this.draw.bind(this)),this.povListener_=google.maps.event.addListener(this.getMap(),"pov_changed",this.draw.bind(this)),a.attachEvent?a.attachEvent("onclick",this.onClick.bind(this)):a.addEventListener("click",this.onClick.bind(this),!1),this.draw()},a.prototype.draw=function(){if(this.pano_){var b=a.povToPixel(this.position_,this.pano_.getPov(),this.pano_.getContainer());null!==b&&(this.marker_.style.left=b.left-this.anchor_.x+"px",this.marker_.style.top=b.top-this.anchor_.y+"px")}},a.prototype.onClick=function(a){this.clickable_&&google.maps.event.trigger(this,"click"),a.cancelBubble=!0,a.stopPropagation&&a.stopPropagation()},a.prototype.onRemove=function(){google.maps.event.removeListener(this.povListener_),this.marker_.parentNode.removeChild(this.marker_),this.marker_=null},a.prototype.getAnchor=function(){return this.anchor_},a.prototype.getClassName=function(){return this.className_},a.prototype.getClickable=function(){return this.clickable_},a.prototype.getIcon=function(){return this.icon_},a.prototype.getId=function(){return this.id_},a.prototype.getPano=function(){return this.pano_},a.prototype.getPosition=function(){return this.position_},a.prototype.getSize=function(){return this.size_},a.prototype.getTitle=function(){return this.title_},a.prototype.getVisible=function(){return this.visible_},a.prototype.getZIndex=function(){return this.zIndex_},a.prototype.setAnchor=function(a){this.anchor_=a,this.draw()},a.prototype.setClassName=function(a){this.className_=a,this.marker_&&(this.marker_.className=a)},a.prototype.setClickable=function(a){this.clickable_=a},a.prototype.setIcon=function(a){this.icon_=a,this.marker_&&(this.marker_.style.backgroundImage=a?"url("+a+")":"")},a.prototype.setId=function(a){this.id_=a,this.marker_&&(this.marker_.id=a)},a.prototype.setPano=function(a){if(a&&!(a instanceof google.maps.StreetViewPanorama))throw"PanoMarker only works inside a StreetViewPanorama.";if(this.pano_&&this.onRemove(),this.setMap(a),this.pano_=a,a)if(this.getPanes())this.onAdd();else{var b=function(){this.getPanes()&&(window.clearInterval(this.pollId_),this.onAdd())};this.pollId_=window.setInterval(b.bind(this),10)}},a.prototype.setPosition=function(a){this.position_=a,this.draw()},a.prototype.setSize=function(a){this.size_=a,this.marker_&&(this.marker_.style.width=a.width+"px",this.marker_.style.height=a.height+"px",this.draw())},a.prototype.setTitle=function(a){this.title_=a,this.marker_&&(this.marker_.title=a)},a.prototype.setVisible=function(a){this.visible_=a,this.marker_&&(this.marker_.style.display=a?"block":"none")},a.prototype.setZIndex=function(a){this.zIndex_=a,this.marker_&&(this.marker_.style.zIndex=a)},a});
