/**
 * @license Copyright 2014 Martin Matysiak.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
(function(e,t){if(typeof module==="object"&&typeof module.exports==="object"){module.exports=t()}else if(typeof define==="function"&&typeof define.amd==="object"){define(["goog!maps,3,other_params:[sensor=false&libraries=visualization]"],t)}else{if(typeof google!=="object"||typeof google.maps!=="object"){throw new Error("PanoMarker requires google maps library")}e.PanoMarker=t()}})(typeof window!=="undefined"?window:this,function(){var e=function(e){e=e||{};this.anchor_=e.anchor||new google.maps.Point(16,16);this.className_=e.className||null;this.clickable_=e.clickable||true;this.icon_=e.icon||null;this.id_=e.id||null;this.marker_=null;this.pano_=null;this.pollId_=-1;this.position_=e.position||{heading:0,pitch:0};this.povListener_=null;this.size_=e.size||new google.maps.Size(32,32);this.title_=e.title||"";this.visible_=e.visible||true;this.zIndex_=e.zIndex||1;this.setPano(e.pano||null)};e.prototype=new google.maps.OverlayView;e.getFov=function(e){return e<=2?126.5-e*36.75:195.93/Math.pow(1.92,e)};e.povToPixel=function(t,n,r){var i=r.offsetWidth;var s=r.offsetHeight;var o={left:i/2,top:s/2};var u=Math.PI/180;var a=e.getFov(n.zoom||1)*u;var f=n.heading*u;var l=n.pitch*u;var c=t.heading*u;var h=t.pitch*u;var p=i/2/Math.tan(a/2);var d=Math.cos(h);var v=Math.sin(h);var m=Math.cos(c);var g=Math.sin(c);var y=p*d*g;var b=p*d*m;var w=p*v;var E=Math.cos(l);var S=Math.sin(l);var x=Math.cos(f);var T=Math.sin(f);var N=p*E*T;var C=p*E*x;var k=p*S;var L=N*y+C*b+k*w;var A=N*N+C*C+k*k;if(Math.abs(L)<1e-6){return null}var O=A/L;if(O<0){return null}var M=O*y;var _=O*b;var D=O*w;var P=-S*T;var H=-S*x;var B=E;var j=x;var F=-T;var I=0;var q=Math.sqrt(j*j+F*F+I*I);j/=q;F/=q;I/=q;var R=M*j+_*F+D*I;var U=M*P+_*H+D*B;o.left+=R;o.top-=U;return o};e.prototype.onAdd=function(){if(!!this.marker_){return}var e=document.createElement("div");e.style.position="absolute";e.style.cursor="pointer";e.style.width=this.size_.width+"px";e.style.height=this.size_.height+"px";e.style.display=this.visible_?"block":"none";e.style.zIndex=this.zIndex_;if(this.id_){e.id=this.id_}if(this.className_){e.className=this.className_}if(this.title_){e.title=this.title_}if(this.icon_){e.style.backgroundImage="url("+this.icon_+")"}if(!(this.id_||this.className_||this.icon_)){e.style.backgroundImage="url(https://www.google.com/intl/en_us/"+"mapfiles/ms/micons/red-dot.png)"}this.marker_=e;this.getPanes().overlayMouseTarget.appendChild(e);window.addEventListener("resize",this.draw.bind(this));this.povListener_=google.maps.event.addListener(this.getMap(),"pov_changed",this.draw.bind(this));if(e.attachEvent){e.attachEvent("onclick",this.onClick.bind(this))}else{e.addEventListener("click",this.onClick.bind(this),false)}this.draw()};e.prototype.draw=function(){if(!this.pano_){return}var t=e.povToPixel(this.position_,this.pano_.getPov(),this.pano_.getContainer());if(t!==null){this.marker_.style.left=t.left-this.anchor_.x+"px";this.marker_.style.top=t.top-this.anchor_.y+"px"}else{this.marker_.style.left=-(9999+this.size_.width)+"px";this.marker_.style.top="0"}};e.prototype.onClick=function(e){if(this.clickable_){google.maps.event.trigger(this,"click")}e.cancelBubble=true;if(e.stopPropagation){e.stopPropagation()}};e.prototype.onRemove=function(){if(!this.marker_){return}google.maps.event.removeListener(this.povListener_);this.marker_.parentNode.removeChild(this.marker_);this.marker_=null};e.prototype.getAnchor=function(){return this.anchor_};e.prototype.getClassName=function(){return this.className_};e.prototype.getClickable=function(){return this.clickable_};e.prototype.getIcon=function(){return this.icon_};e.prototype.getId=function(){return this.id_};e.prototype.getPano=function(){return this.pano_};e.prototype.getPosition=function(){return this.position_};e.prototype.getSize=function(){return this.size_};e.prototype.getTitle=function(){return this.title_};e.prototype.getVisible=function(){return this.visible_};e.prototype.getZIndex=function(){return this.zIndex_};e.prototype.setAnchor=function(e){this.anchor_=e;this.draw()};e.prototype.setClassName=function(e){this.className_=e;if(!!this.marker_){this.marker_.className=e}};e.prototype.setClickable=function(e){this.clickable_=e};e.prototype.setIcon=function(e){this.icon_=e;if(!!this.marker_){this.marker_.style.backgroundImage=!!e?"url("+e+")":""}};e.prototype.setId=function(e){this.id_=e;if(!!this.marker_){this.marker_.id=e}};e.prototype.setPano=function(e){if(!!e&&!(e instanceof google.maps.StreetViewPanorama)){throw"PanoMarker only works inside a StreetViewPanorama."}if(!!this.pano_){this.onRemove()}this.setMap(e);this.pano_=e;if(!!e){if(!!this.getPanes()){this.onAdd()}else{var t=function(){if(!!this.getPanes()){window.clearInterval(this.pollId_);this.onAdd()}};this.pollId_=window.setInterval(t.bind(this),10)}}};e.prototype.setPosition=function(e){this.position_=e;this.draw()};e.prototype.setSize=function(e){this.size_=e;if(!!this.marker_){this.marker_.style.width=e.width+"px";this.marker_.style.height=e.height+"px";this.draw()}};e.prototype.setTitle=function(e){this.title_=e;if(!!this.marker_){this.marker_.title=e}};e.prototype.setVisible=function(e){this.visible_=e;if(!!this.marker_){this.marker_.style.display=e?"block":"none"}};e.prototype.setZIndex=function(e){this.zIndex_=e;if(!!this.marker_){this.marker_.style.zIndex=e}};return e})
