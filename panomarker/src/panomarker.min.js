/**
 * @license Copyright 2014 â€” 2015 Martin Matysiak.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
!function(a,b){if("object"==typeof module&&"object"==typeof module.exports)module.exports=b();else if("function"==typeof define&&"object"==typeof define.amd)define(["goog!maps,3,other_params:[sensor=false&libraries=visualization]"],b);else{if("object"!=typeof google||"object"!=typeof google.maps)throw new Error("PanoMarker requires google maps library");a.PanoMarker=b()}}("undefined"!=typeof window?window:this,function(){var a=function(b){if(b=b||{},!b.container)throw"A panorama container needs to be defined.";this.container_=b.container,this.povToPixel_=window.chrome?a.povToPixel3d:a.povToPixel2d,this.anchor_=b.anchor||new google.maps.Point(16,16),this.className_=b.className||null,this.clickable_=b.clickable||!0,this.icon_=b.icon||null,this.id_=b.id||null,this.marker_=null,this.pano_=null,this.pollId_=-1,this.position_=b.position||{heading:0,pitch:0},this.povListener_=null,this.zoomListener_=null,this.size_=b.size||new google.maps.Size(32,32),this.title_=b.title||"",this.visible_="boolean"==typeof b.visible?b.visible:!0,this.zIndex_=b.zIndex||1,this.setPano(b.pano||null,b.container)};return a.prototype=new google.maps.OverlayView,a.get3dFov=function(a){return 2>=a?126.5-36.75*a:195.93/Math.pow(1.92,a)},a.povToPixel3d=function(b,c,d,e){var f=e.offsetWidth,g=e.offsetHeight,h={left:f/2,top:g/2},i=Math.PI/180,j=a.get3dFov(d)*i,k=c.heading*i,l=c.pitch*i,m=b.heading*i,n=b.pitch*i,o=f/2/Math.tan(j/2),p=Math.cos(n),q=Math.sin(n),r=Math.cos(m),s=Math.sin(m),t=o*p*s,u=o*p*r,v=o*q,w=Math.cos(l),x=Math.sin(l),y=Math.cos(k),z=Math.sin(k),A=o*w*z,B=o*w*y,C=o*x,D=A*t+B*u+C*v,E=A*A+B*B+C*C;if(Math.abs(D)<1e-6)return null;var F=E/D;if(0>F)return null;var G=F*t,H=F*u,I=F*v,J=-x*z,K=-x*y,L=w,M=y,N=-z,O=0,P=Math.sqrt(M*M+N*N+O*O);M/=P,N/=P,O/=P;var Q=G*M+H*N+I*O,R=G*J+H*K+I*L;return h.left+=Q,h.top-=R,h},a.wrapHeading=function(a){return a=(a+180)%360,0>a&&(a+=360),a-180},a.povToPixel2d=function(b,c,d,e){var f=e.offsetWidth,g=e.offsetHeight,h={left:f/2,top:g/2},i=180/Math.pow(2,d),j=i*(g/f),k=a.wrapHeading(b.heading-c.heading),l=b.pitch-c.pitch;return h.left+=k/i*f,h.top-=l/j*g,h},a.prototype.onAdd=function(){if(!this.marker_){var a=document.createElement("div");a.style.position="absolute",a.style.cursor="pointer",a.style.width=this.size_.width+"px",a.style.height=this.size_.height+"px",a.style.display=this.visible_?"block":"none",a.style.zIndex=this.zIndex_,this.id_&&(a.id=this.id_),this.className_&&(a.className=this.className_),this.title_&&(a.title=this.title_),this.icon_&&(a.style.backgroundImage="url("+this.icon_+")"),this.id_||this.className_||this.icon_||(a.style.backgroundImage="url(https://www.google.com/intl/en_us/mapfiles/ms/micons/red-dot.png)"),this.marker_=a,this.getPanes().overlayMouseTarget.appendChild(a),window.addEventListener("resize",this.draw.bind(this)),this.povListener_=google.maps.event.addListener(this.getMap(),"pov_changed",this.draw.bind(this)),this.zoomListener_=google.maps.event.addListener(this.getMap(),"zoom_changed",this.draw.bind(this));var b="click";window.PointerEvent?b="pointerdown":window.MSPointerEvent&&(b="MSPointerDown"),a.addEventListener(b,this.onClick.bind(this),!1),this.draw(),google.maps.event.trigger(this,"add",this.marker_)}},a.prototype.draw=function(){if(this.pano_){var a=this.povToPixel_(this.position_,this.pano_.getPov(),null!==this.pano_.getZoom()?this.pano_.getZoom():1,this.container_);null!==a?(this.marker_.style.left=a.left-this.anchor_.x+"px",this.marker_.style.top=a.top-this.anchor_.y+"px"):(this.marker_.style.left=-(9999+this.size_.width)+"px",this.marker_.style.top="0")}},a.prototype.onClick=function(a){this.clickable_&&google.maps.event.trigger(this,"click"),a.cancelBubble=!0,a.stopPropagation&&a.stopPropagation()},a.prototype.onRemove=function(){this.marker_&&(google.maps.event.removeListener(this.povListener_),google.maps.event.removeListener(this.zoomListener_),this.marker_.parentNode.removeChild(this.marker_),this.marker_=null,google.maps.event.trigger(this,"remove"))},a.prototype.getAnchor=function(){return this.anchor_},a.prototype.getClassName=function(){return this.className_},a.prototype.getClickable=function(){return this.clickable_},a.prototype.getIcon=function(){return this.icon_},a.prototype.getId=function(){return this.id_},a.prototype.getPano=function(){return this.pano_},a.prototype.getPosition=function(){return this.position_},a.prototype.getSize=function(){return this.size_},a.prototype.getTitle=function(){return this.title_},a.prototype.getVisible=function(){return this.visible_},a.prototype.getZIndex=function(){return this.zIndex_},a.prototype.setAnchor=function(a){this.anchor_=a,this.draw()},a.prototype.setClassName=function(a){this.className_=a,this.marker_&&(this.marker_.className=a)},a.prototype.setClickable=function(a){this.clickable_=a},a.prototype.setIcon=function(a){this.icon_=a,this.marker_&&(this.marker_.style.backgroundImage=a?"url("+a+")":"")},a.prototype.setId=function(a){this.id_=a,this.marker_&&(this.marker_.id=a)},a.prototype.setPano=function(a,b){if(a&&!(a instanceof google.maps.StreetViewPanorama))throw"PanoMarker only works inside a StreetViewPanorama.";if(this.pano_&&this.onRemove(),this.setMap(a),this.pano_=a,this.container_=b,a){var c=function(a){var b=function(){this.getPanes()&&(window.clearInterval(this.pollId_),this.onAdd(),a&&a(this))};this.pollId_=window.setInterval(b.bind(this),10)};if("undefined"!=typeof Promise)return new Promise(c.bind(this));c.call(this)}},a.prototype.setPosition=function(a){this.position_=a,this.draw()},a.prototype.setSize=function(a){this.size_=a,this.marker_&&(this.marker_.style.width=a.width+"px",this.marker_.style.height=a.height+"px",this.draw())},a.prototype.setTitle=function(a){this.title_=a,this.marker_&&(this.marker_.title=a)},a.prototype.setVisible=function(a){this.visible_=a,this.marker_&&(this.marker_.style.display=a?"block":"none")},a.prototype.setZIndex=function(a){this.zIndex_=a,this.marker_&&(this.marker_.style.zIndex=a)},a});